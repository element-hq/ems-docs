<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js element">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>EMS Server With Custom Domain - Element Documentation</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Documentation for Element and EMS by the EMS team">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="src/book-assets/element-theme.css">
        <link rel="stylesheet" href="src/book-assets/font.css">
        <link rel="stylesheet" href="src/book-assets/logo.css">
        <link rel="stylesheet" href="src/book-assets/remove-nav-buttons.css">
        <link rel="stylesheet" href="src/book-assets/style.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "element";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('element')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html">Element Docs</a></li><li class="chapter-item expanded "><a href="Frequently-Asked-Questions.html">Frequently Asked Questions</a></li><li class="chapter-item expanded affix "><li class="part-title">Element Matrix Services</li><li class="chapter-item expanded "><a href="Add-Additional-Users.html">Add Additional Users</a></li><li class="chapter-item expanded "><a href="Add-Users.html">Add Users</a></li><li class="chapter-item expanded "><a href="Client-Look-and-Feel.html">Client Look &amp; Feel</a></li><li class="chapter-item expanded "><a href="EMS-Server-With-Custom-Domain.html" class="active">EMS Server With Custom Domain</a></li><li class="chapter-item expanded "><a href="Get-Your-Own-EMS-Server.html">Get Your Own EMS Server</a></li><li class="chapter-item expanded "><a href="Reset-User-Password.html">Reset User Password</a></li><li class="chapter-item expanded "><a href="Migrate-From-Self-Hosted-to-EMS.html">Migrate From Self-Hosted to EMS</a></li><li class="chapter-item expanded "><a href="Import-Database-and-Media-Dump.html">Import Database and Media Dump</a></li><li class="chapter-item expanded affix "><li class="part-title">Integrations</li><li class="chapter-item expanded "><a href="Create-a-Conference-Call-in-a-Room.html">Create a Conference Call in a Room</a></li><li class="chapter-item expanded "><div>Authentication</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="authentication/Google-SAML.html">Google SAML</a></li><li class="chapter-item expanded "><a href="authentication/LDAP-Active-Directory.html">LDAP Active Directory</a></li><li class="chapter-item expanded "><a href="authentication/OpenID-Connect.html">OpenID Connect</a></li></ol></li><li class="chapter-item expanded "><div>EMS bridges</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="integrations/Discord-Bridge.html">Discord Bridge</a></li><li class="chapter-item expanded "><a href="integrations/Signal-Bridge.html">Signal Bridge</a></li><li class="chapter-item expanded "><a href="integrations/ems-Slack-Bridge.html">Slack Bridge</a></li><li class="chapter-item expanded "><a href="integrations/Teams-Bridge.html">Teams Bridge</a></li><li class="chapter-item expanded "><a href="integrations/Telegram-Bridge.html">Telegram Bridge</a></li><li class="chapter-item expanded "><a href="integrations/WhatsApp-Bridge.html">WhatsApp Bridge</a></li></ol></li><li class="chapter-item expanded "><div>Matrix.org hosted bridges</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="integrations/morg-IRC-Bridge.html">Public IRC Bridges</a></li><li class="chapter-item expanded "><a href="integrations/morg-Slack-Bridge.html">Public Slack Bridge</a></li></ol></li><li class="chapter-item expanded "><div>Extensions</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="integrations/Admin-Bot.html">Admin Bot</a></li><li class="chapter-item expanded "><a href="integrations/Audit-Bot.html">Audit Bot</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Element</li><li class="chapter-item expanded "><a href="Add-Email-to-Your-Account.html">Add Email to Your Account</a></li><li class="chapter-item expanded "><a href="Change-Account-Password.html">Change Account Password</a></li><li class="chapter-item expanded "><a href="Submit-Debug-Logs.html">Submit Debug Logs</a></li><li class="chapter-item expanded affix "><li class="part-title">Cross Signing</li><li class="chapter-item expanded "><a href="Set-up-Cross-Signing.html">Set up Cross Signing</a></li><li class="chapter-item expanded "><a href="Check-Status.html">Check Status</a></li><li class="chapter-item expanded "><a href="Export-and-Import-E2E-Room-Keys.html">Export and Import E2E Room Keys</a></li><li class="chapter-item expanded "><a href="Reset-Cross-Signing.html">Reset Cross Signing</a></li><li class="chapter-item expanded "><a href="Verify-new-Login.html">Verify new Login</a></li><li class="chapter-item expanded affix "><li class="part-title">Non-English</li><li class="chapter-item expanded "><a href="Nutzung-der-eigenen-Domain-mit-EMS.html">Deutsch: Nutzung der eigenen Domain mit EMS</a></li><li class="chapter-item expanded affix "><li class="part-title">Contribute</li><li class="chapter-item expanded "><a href="Contribute.html">Contribute</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="element">Element (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        <img alt="Element logo" class="header-logo" src="">
                    </div>

                    <h1 class="menu-title">Element Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/vector-im/ems-docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/vector-im/ems-docs/edit/main/src/EMS-Server-With-Custom-Domain.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <h1 id="ems-server-with-custom-domain"><a class="header" href="#ems-server-with-custom-domain">EMS Server With Custom Domain</a></h1>
<p>For this guide, I will be using the domain <a href="https://twily.org/">twily.org</a>. I will set up EMS so that the Matrix usernames becomes <code>@someone:twily.org</code>, and the Element client will be at <a href="https://chat.twily.org/">https://chat.twily.org/</a></p>
<p>From the guide at <a href="Get-Your-Own-EMS-Server.html">Get Your Own EMS Server</a>, I will be replacing the EMS hostname <code>ems-demo-staging.ems.host</code> with <code>ems-custom-demo-staging.ems.host</code></p>
<p>The guide assumes you already have a website on the root of your domain with <code>https</code> enabled.<br />
<img src="images/Screen%20Shot%202020-07-31%20at%209.06.17%20AM.png" alt="temp" /></p>
<ol>
<li>
<p>Follow step 1 - 10 from <a href="Get-Your-Own-EMS-Server.html">Get Your Own EMS Server</a></p>
</li>
<li>
<p>On step 10 from <a href="Get-Your-Own-EMS-Server.html">Get Your Own EMS Server</a>, turn ON <code>Custom DNS</code><br />
<img src="images/Screen%20Shot%202020-07-31%20at%209.07.59%20AM.png" alt="temp" /></p>
</li>
<li>
<p>In the <code>Custom Homeserver domain</code> field, enter <code>twily.org</code><br />
<img src="images/Screen%20Shot%202020-07-31%20at%209.08.47%20AM.png" alt="temp" /></p>
</li>
<li>
<p>Create two files on your website according to the instructions given.<br />
The path cannot be changed, but up to 30 redirects are supported.<br />
While not required, you should also add the header <code>Content-Type application/json</code> to both files.</p>
<ol>
<li>
<p><code>https://twily.org/.well-known/matrix/server</code><br />
<img src="images/Screen%20Shot%202020-07-31%20at%209.12.39%20AM.png" alt="temp" /></p>
<pre><code class="language-json">{
    &quot;m.server&quot;: &quot;ems-custom-demo-staging.ems.host:443&quot;
}
</code></pre>
</li>
<li>
<p><code>https://twily.org/.well-known/matrix/client</code><br />
<img src="images/Screen%20Shot%202020-07-31%20at%209.19.07%20AM.png" alt="temp" /><br />
You need to enable the CORS header <code>Access-Control-Allow-Origin: *</code> on the web server for this file. See <a href="https://enable-cors.org/">https://enable-cors.org/</a> for instructions on how to do this.</p>
<pre><code class="language-json">{
    &quot;m.homeserver&quot;: {
        &quot;base_url&quot;: &quot;https://ems-custom-demo-staging.ems.host&quot;
    },
    &quot;m.identity_server&quot;: {
        &quot;base_url&quot;: &quot;https://vector.im&quot;
    }
}
</code></pre>
</li>
</ol>
</li>
<li>
<p>Click <code>Check again</code> to verify that your <code>.well-known</code> files are configured correctly<br />
<img src="images/Screen%20Shot%202020-07-31%20at%209.22.19%20AM.png" alt="temp" /></p>
</li>
<li>
<p>You can also verify your <code>.well-known</code> files from the command line. Note the lines <code>access-control-allow-origin: *</code> and <code>content-type: application/json</code></p>
<ol>
<li>
<p>On Mac or Linux, using your <code>terminal</code></p>
<pre><code class="language-bash">$ curl -i https://twily.org/.well-known/matrix/client
HTTP/2 200 
date: Fri, 31 Jul 2020 09:11:21 GMT
content-type: application/json
content-length: 129
set-cookie: __cfduid=x...; expires=Sun, 30-Aug-20 09:11:21 GMT; path=/; domain=.twily.org; HttpOnly; SameSite=Lax
access-control-allow-origin: *
cf-cache-status: DYNAMIC
cf-request-id: 0...
expect-ct: max-age=604800, report-uri=&quot;https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct&quot;
server: cloudflare
cf-ray: 5...

{
    &quot;m.homeserver&quot;: {
        &quot;base_url&quot;: &quot;https://ems-custom-demo-staging.ems.host&quot;
    },
    &quot;m.identity_server&quot;: {
        &quot;base_url&quot;: &quot;https://vector.im&quot;
    }
}

$ curl -i https://twily.org/.well-known/matrix/server
HTTP/2 200 
date: Fri, 31 Jul 2020 09:11:25 GMT
content-type: application/json
content-length: 52
set-cookie: __cfduid=x...; expires=Sun, 30-Aug-20 09:11:25 GMT; path=/; domain=.twily.org; HttpOnly; SameSite=Lax
access-control-allow-origin: *
cf-cache-status: DYNAMIC
cf-request-id: 0...
expect-ct: max-age=604800, report-uri=&quot;https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct&quot;
server: cloudflare
cf-ray: 5...

{
    &quot;m.server&quot;: &quot;ems-custom-demo-staging.ems.host:443&quot;
}  
</code></pre>
</li>
<li>
<p>On Windows, using <code>PowerShell</code></p>
<pre><code class="language-powershell">PS C:\Users\twilight&gt; Invoke-WebRequest -Uri https://twily.org/.well-known/matrix/client


StatusCode        : 200
StatusDescription : OK
Content           : {
                        &quot;m.homeserver&quot;: {
                            &quot;base_url&quot;: &quot;https://ems-custom-demo-staging.ems.host&quot;
                        },
                        &quot;m.identity_server&quot;: {
                            &quot;base_url&quot;: &quot;https://vector.im&quot;
                        }
                    }
RawContent        : HTTP/1.1 200 OK
                    Connection: keep-alive
                    Access-Control-Allow-Origin: *
                    CF-Cache-Status: DYNAMIC
                    cf-request-id: 0...
                    Expect-CT: max-age=604800, report-uri=&quot;https://repor...
Forms             : {}
Headers           : {[Connection, keep-alive], [Access-Control-Allow-Origin, *], [CF-Cache-Status, DYNAMIC], [cf-request-id, 0...]...}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : System.__ComObject
RawContentLength  : 129


PS C:\Users\twilight&gt; Invoke-WebRequest -Uri https://twily.org/.well-known/matrix/server


StatusCode        : 200
StatusDescription : OK
Content           : {
                        &quot;m.server&quot;: &quot;ems-custom-demo-staging.ems.host:443&quot;
                    }
RawContent        : HTTP/1.1 200 OK
                    Connection: keep-alive
                    Access-Control-Allow-Origin: *
                    CF-Cache-Status: DYNAMIC
                    cf-request-id: 0...
                    Expect-CT: max-age=604800, report-uri=&quot;https://repor...
Forms             : {}
Headers           : {[Connection, keep-alive], [Access-Control-Allow-Origin, *], [CF-Cache-Status, DYNAMIC], [cf-request-id, 0...]...}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : System.__ComObject
RawContentLength  : 52
</code></pre>
</li>
</ol>
</li>
<li>
<p>You can continue without the <code>.well-known</code> files in place, but your server will have limited functionality until this is fixed</p>
</li>
<li>
<p>In the <code>Custom Client domain</code> field, enter <code>chat.twily.org</code>. This can be any domain, except the same as <code>Custom Homeserver domain</code><br />
<img src="images/Screen%20Shot%202020-07-31%20at%209.26.35%20AM.png" alt="temp" /></p>
</li>
<li>
<p>Create a CNAME DNS record with your DNS provider according to the instructions given<br />
<img src="images/Screen%20Shot%202020-07-31%20at%209.51.37%20AM.png" alt="temp" /><br />
<code>chat.twily.org.  CNAME  ems-custom-demo-staging.element.io.</code></p>
</li>
<li>
<p>This shows how this is done with CloudFlare DNS. Depending on your DNS provider this might be different. Consult the documentation for your provider. Note that Proxy must be turned off with CloudFlare.<br />
<img src="images/Screen%20Shot%202020-07-31%20at%209.52.41%20AM.png" alt="temp" /></p>
</li>
<li>
<p>Back on EMS, click <code>Check again</code>. Note that sometimes it might take a while for your new DNS record to propagate. You can still continue, but functionality will be limited. Check back with the Hosts tab on <a href="https://ems.element.io/user/hosting">https://ems.element.io/user/hosting</a> and click <code>Rebuild Host</code> once the DNS record is in place.<br />
<img src="images/Screen%20Shot%202020-07-31%20at%209.56.18%20AM.png" alt="temp" /></p>
</li>
<li>
<p>You can also verify your CNAME DNS record using the command line</p>
<ol>
<li>
<p>On Mac or Linux, using your <code>terminal</code></p>
<pre><code class="language-bash">$ dig chat.twily.org CNAME

; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; chat.twily.org CNAME
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 57888
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;chat.twily.org.   IN CNAME

;; ANSWER SECTION:
chat.twily.org.  299 IN CNAME ems-custom-demo-staging.element.io.

;; Query time: 32 msec
;; SERVER: 8.8.4.4#53(8.8.4.4)
;; WHEN: Fri Jul 31 10:21:56 BST 2020
;; MSG SIZE  rcvd: 91
</code></pre>
</li>
<li>
<p>On Windows, using <code>PowerShell</code></p>
<pre><code class="language-powershell">PS C:\Users\twilight&gt; Resolve-DnsName -Name chat.twily.org -Type CNAME

Name                           Type   TTL   Section    NameHost
----                           ----   ---   -------    --------
chat.twily.org                 CNAME  299   Answer     ems-custom-demo-staging.element.io
</code></pre>
</li>
</ol>
</li>
<li>
<p>Continue from step 11 on <a href="Get-Your-Own-EMS-Server.html">Get Your Own EMS Server</a></p>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Client-Look-and-Feel.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="Get-Your-Own-EMS-Server.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Client-Look-and-Feel.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="Get-Your-Own-EMS-Server.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="src/book-assets/sidebar.js"></script>
    </body>
</html>
